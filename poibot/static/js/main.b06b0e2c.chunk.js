(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[0],{248:function(e,t,n){e.exports=n(275)},249:function(e,t,n){},255:function(e,t){},256:function(e,t){},264:function(e,t){},267:function(e,t){},268:function(e,t){},269:function(e,t,n){},275:function(e,t,n){"use strict";n.r(t);n(249);var a=n(145);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i=n(141),r=n(18),o=n(8),s=(n(269),n(270),n(5)),c=n(11),d=n(14),l=n(15),u=n(76),h=i.tensor2d([[0],[0],[1]]),v=(i.tensor2d([[0],[0],[0]]),[0,0]),g=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return n}(Object(u.a)(Error)),f=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return n}(Object(u.a)(Error)),m=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return n}(Object(u.a)(Error)),p=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return n}(Object(u.a)(Error));function M(e){throw new g("Missing required function argument: ".concat(e))}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("position");if(e instanceof i.Tensor){var t=e.dataSync();if(t.length<2||t.length>3)throw new m("Expected `position` tensor to have 2 or 3 elements; got ".concat(e));e=i.tensor1d([t[0],t[1],1]).reshape([3,1])}else if(e instanceof Array){if(e.length<2||e.length>3)throw new m("Expected `position` array to have 2 or 3 elements; got ".concat(e));e=i.tensor2d([[e[0]],[e[1]],[1]])}else{if("number"!=typeof e)throw new TypeError("Expected `position` to be a number, array, or tf.Tensor instance; got ".concat(e));e=i.tensor2d([[e],[0],[1]])}return e}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("state");if(null==e)e=v;else if(e===v);else if("number"==typeof e)e=[e,0];else{if(!(e instanceof Array))throw new TypeError("Expected `state` to be tf.Tensor instance; got ".concat(e));if(0===e.length||e.length>2)throw new m("Expected `state` tuple/array to have 1 or 2 elements; got ".concat(e));e=[e[0],e.length>1?e[1]:0]}return e}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("x"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return null==t&&(t=e),i.tensor2d([[e,0,0],[0,t,0],[0,0,1]])}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("offset");return e=y(e).dataSync(),i.tensor2d([[1,0,e[0]],[0,1,e[1]],[0,0,e[2]]])}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("angle"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("offset");t=y(t).dataSync();var n=Math.cos(e),a=Math.sin(e);return i.tensor2d([[n,-a,t[0]],[a,n,t[1]],[0,0,t[2]]])}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("mat");if(!(e instanceof i.Tensor))throw new TypeError("Expected transformation matrix `mat` to be tf.Tensor instance; got ".concat(e.toString()));if(2!==e.shape.length||3!==e.shape[0]||3!==e.shape[1])throw new m("Expected transformation matrix `mat` to have shape [3, 3]; got ".concat(e.toString()))}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("mat");k(e);var t=e.dataSync();return t[0]*t[4]-t[1]*t[3]}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("mat");return Math.sqrt(Math.abs(x(e)))}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("mat");k(e);var t=e.dataSync();return Math.atan2(t[1],-t[0])}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("mat");k(e);var t=e.dataSync(),n=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-t[0]*t[5]*t[7]-t[1]*t[3]*t[8]-t[2]*t[4]*t[6];return i.tensor2d([[+(t[4]*t[8]-t[5]*t[7])/n,-(t[1]*t[8]-t[2]*t[7])/n,+(t[1]*t[5]-t[2]*t[4])/n],[-(t[3]*t[8]-t[5]*t[6])/n,+(t[0]*t[8]-t[2]*t[6])/n,-(t[0]*t[5]-t[2]*t[3])/n],[+(t[3]*t[7]-t[4]*t[6])/n,-(t[0]*t[7]-t[1]*t[6])/n,+(t[0]*t[4]-t[1]*t[3])/n]])}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("aMat"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("bVec"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.asTensor,r=void 0===a||a;if(!(e instanceof i.Tensor))throw new TypeError("Expected `aMat` to be tf.Tensor instance; got ".concat(e));if(!(t instanceof i.Tensor))throw new TypeError("Expected `bVec` to be tf.Tensor instance; got ".concat(t));if(2!==e.shape.length||e.shape[0]!==e.shape[1])throw new m("Expected `aMat` to be a square matrix (2D tensor); "+"got tensor with shape ".concat(JSON.stringify(e.shape)));if(2!==t.shape.length||1!==t.shape[1])throw new m("Expected `bVec` to be a column vector (2D tensor with one column); "+"got tensor with shape ".concat(JSON.stringify(t.shape)));if(e.shape[1]!==t.shape[0])throw new m("Expected `aMat` and `bVec` to have compatible shapes; "+"got aMat shape ".concat(JSON.stringify(e.shape)," ")+"and bVec shape ".concat(JSON.stringify(t.shape)));for(var s=t.shape[0],c=i.linalg.qr(e),d=Object(o.a)(c,2),l=d[0],u=d[1],h=l.transpose().matMul(t).dataSync(),v=u.arraySync(),g=Array(s),f=s-1;f>=0;f--){if(Math.abs(v[f][f])<1e-6)throw new p("Singular matrix: ".concat(e.toString()));for(var y=0,w=f+1;w<s;w++)y+=v[f][w]*g[w];g[f]=(h[f]-y)/v[f][f]}return r?i.tensor1d(g).reshape([s,1]):g}function F(){return Math.random().toString(36).substr(2,9)}var N=function(){function e(){Object(s.a)(this,e)}return Object(c.a)(e,[{key:"xform",value:function(){arguments.length>0&&void 0!==arguments[0]||M("xformMatrix");throw new f("abstract method")}},{key:"getDomElement",value:function(){arguments.length>0&&void 0!==arguments[0]||M("xformMatrix");var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.key;throw new f("abstract method")}}]),e}(),D=n(40),T=n.n(D),A=i.tensor2d([[-.5,-.5,1],[.5,-.5,1],[.5,.5,1],[-.5,.5,1]]).transpose(),q=i.tensor2d([[0,0,1],[1,0,1],[1,1,1],[0,1,1]]).transpose(),I=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=a.width,r=void 0===i?1:i,o=a.height,c=void 0===o?1:o,d=a.position,l=void 0===d?h:d,u=a.angle,v=void 0===u?0:u,g=a.centered,f=void 0===g||g,m=a.solid,p=void 0===m||m,M=a.lineWidth,w=void 0===M?1:M,O=a.color,k=void 0===O?"black":O;return Object(s.a)(this,n),(e=t.call(this)).width=r,e.height=c,e.position=y(l),e.angle=v,e.centered=!!f,e.solid=!!p,e.lineWidth=w,e.color=k,e._cornerPositions=j(-v,e.position).matMul(b(r,c)).matMul(f?A:q),e}return Object(c.a)(n,[{key:"xform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("xformMatrix"),t=E(e);return new n({width:this.width*t,height:this.height*t,position:e.matMul(this.position),angle:this.angle+S(e),centered:this.centered,solid:this.solid,lineWidth:this.lineWidth*t,color:this.color})}},{key:"getDomElement",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("xformMatrix"),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.key,i=void 0===a?void 0:a,r=E(t),o=t.matMul(this._cornerPositions).arraySync();if(this.solid){t.matMul(this.position).dataSync();e=T.a.createElement("rect",{x:o[0][3],y:o[1][3],width:this.width*r,height:this.height*r,key:i})}else{for(var s=this._cornerPositions.shape[1],c=[],d=0;d<s;d++){var l=(d+1)%s;c.push(T.a.createElement("line",{className:"plot__line",x1:o[0][d],y1:o[1][d],x2:o[0][l],y2:o[1][l],strokeWidth:this.lineWidth*r,stroke:this.color,key:d}))}e=T.a.createElement("g",{key:i},c)}return e}}]),n}(N),W=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=a.position,r=void 0===i?h:i,o=a.radius,c=void 0===o?1:o,d=a.color,l=void 0===d?"black":d;return Object(s.a)(this,n),(e=t.call(this)).position=y(r),e.radius=c,e.color=l,e}return Object(c.a)(n,[{key:"xform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("xformMatrix"),t=E(e);return n({position:e.matMul(this.position),radius:this.radius*t})}},{key:"getDomElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("xformMatrix"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.key,a=void 0===n?void 0:n,i=e.matMul(this.position).dataSync(),r=E(e);return T.a.createElement("circle",{className:"plot__circle",cx:i[0],cy:i[1],r:this.radius*r,fill:this.color,key:a})}}]),n}(N),V=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=a.endPos,r=void 0===i?M("endPos"):i,o=a.startPos,c=void 0===o?h:o,d=a.lineWidth,l=void 0===d?1:d,u=a.color,v=void 0===u?"black":u;return Object(s.a)(this,n),(e=t.call(this)).startPos=y(c),e.endPos=y(r),e.lineWidth=l,e.color=v,e}return Object(c.a)(n,[{key:"xform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("xformMatrix"),t=E(e);return n({endPos:e.matMul(this.endPos),startPos:e.matMul(this.startPos),lineWidth:this.lineWidth*t,color:this.color})}},{key:"getDomElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("xformMatrix"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.key,a=void 0===n?void 0:n,i=e.matMul(this.startPos).dataSync(),r=e.matMul(this.endPos).dataSync(),o=E(e);return T.a.createElement("line",{className:"plot__line",x1:i[0],y1:i[1],x2:r[0],y2:r[1],strokeWidth:this.lineWidth*o,stroke:this.color,key:a})}}]),n}(N),K=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.position,a=void 0===n?h:n,i=t.decals,r=void 0===i?[]:i,o=t.weights,c=void 0===o?[]:o,d=t.frames,l=void 0===d?[]:d,u=t.resistance,g=void 0===u?0:u,f=t.initialState,m=void 0===f?v:f,p=t.id,M=void 0===p?null:p;Object(s.a)(this,e),this.id=null!=M?M:F(),this.position=y(a),this.decals=r,this.weights=c,this.frames=l,this.resistance=g,this.initialState=w(m)}return Object(c.a)(e,[{key:"getPosMatrix",value:function(){arguments.length>0&&void 0!==arguments[0]||M("q");return i.eye(3)}},{key:"getVelMatrix",value:function(){arguments.length>0&&void 0!==arguments[0]||M("q");return i.zeros([3,3])}},{key:"getAccelMatrix",value:function(){arguments.length>0&&void 0!==arguments[0]||M("q");return i.zeros([3,3])}},{key:"getDomElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("stateMap"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("xformMatrix"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.key,i=void 0===a?void 0:a,r=e.has(this.id)?e.get(this.id):v,s=Object(o.a)(r,1),c=s[0];return t=t.matMul(this.getPosMatrix(c)),T.a.createElement("g",{className:"frame",key:i},this.decals.map((function(e,n){return e.getDomElement(t,{key:"decal"+n})})),this.frames.map((function(n,a){return n.getDomElement(e,t,{key:"frame"+a})})))}}]),e}(),R=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.position,i=void 0===a?h:a,r=e.decals,o=void 0===r?[]:r,c=e.weights,d=void 0===c?[]:c,l=e.frames,u=void 0===l?[]:l,g=e.resistance,f=void 0===g?0:g,m=e.initialState,p=void 0===m?v:m,M=e.id,y=void 0===M?null:M;return Object(s.a)(this,n),t.call(this,{position:i,decals:o,weights:d,frames:u,resistance:f,initialState:p,id:y})}return Object(c.a)(n,[{key:"xform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("xformMatrix"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.decals,i=void 0===a?void 0:a,r=t.weights,o=void 0===r?void 0:r,s=t.frames,c=void 0===s?void 0:s;return new n({position:e.matMul(this.position),decals:null!=i?i:this.decals,weights:null!=o?o:this.weights,frames:null!=c?c:this.frames,resistance:this.resistance,initialState:this.initialState})}},{key:"getPosMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("q"),t=this.position.dataSync(),n=Math.cos(e),a=Math.sin(e);return i.tensor2d([[n,-a,t[0]],[a,n,t[1]],[0,0,1]])}},{key:"getVelMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("q"),t=Math.cos(e),n=Math.sin(e);return i.tensor2d([[-n,-t,0],[t,-n,0],[0,0,0]])}},{key:"getAccelMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("q"),t=Math.cos(e),n=Math.sin(e);return i.tensor2d([[-t,n,0],[-n,-t,0],[0,0,0]])}}]),n}(K),C=function(e){return e.parents},J=function(e){return e};function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.getNodeParents,a=void 0===n?void 0:n,i=t.getNodeKey,o=void 0===i?void 0:i;a=a||C,o=o||J;var s=new Set,c=[],d=[],l=Object(r.a)(e);function u(e,t){var n=o(e);if(s.has(n))throw new Error("Graph is not a DAG; recursively encountered ".concat(e));if(!d.includes(n)){var i=a(e);i&&(s.add(n),i.forEach((function(t){return u(t,e)})),s.delete(n),c.push(e),d.push(n))}}for(;l.length;){var h=l.pop();u(h)}return c}function L(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.getNodeParents,a=void 0===n?void 0:n,i=t.getNodeKey,r=void 0===i?void 0:i,o=z(e,{getNodeParents:a=a||C,getNodeKey:r=r||J}),s=new Map;return o.forEach((function(e){var t=r(e),n=a(e);s.has(t)||s.set(t,new Set),n.forEach((function(t){var n=r(t);s.has(n)||s.set(n,new Set),s.get(n).add(e)}))})),s}function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.getNodeParents,a=void 0===n?void 0:n,i=t.getNodeKey,r=void 0===i?void 0:i,o=t.visitNode,s=void 0===o?void 0:o,c=t.visitEdge,d=void 0===c?void 0:c;s=s||function(e,t){return null},d=d||function(e,t,n){return n};var l=z(e,{getNodeParents:a=a||C,getNodeKey:r=r||J}),u=new Map,h=new Map;return l.forEach((function(e){var t=r(e),n=a(e).map((function(n){var a=r(n),i=d(e,n,u.get(a));return h.set([a,t],i),i})),i=s(e,n);u.set(t,i)})),[u,h]}function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.getNodeParents,a=void 0===n?void 0:n,i=t.getNodeKey,r=void 0===i?void 0:i,s=t.visitNode,c=void 0===s?void 0:s,d=B(e,{getNodeParents:a,getNodeKey:r,visitNode:c}),l=Object(o.a)(d,1),u=l[0];return u}var U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.decals,a=void 0===n?[]:n,i=t.frames,c=void 0===i?[]:i,d=t.springs,l=void 0===d?[]:d,u=t.constraints,h=void 0===u?[]:u,v=t.gravity,g=void 0===v?10:v;Object(s.a)(this,e),this.decals=a,this.frames=c,this.springs=l,this.constraints=h,this.gravity=g;var f=function(e){return e.frames},m=function(e){return e.id};this.sortedFrames=z(this.frames,{getNodeParents:f,getNodeKey:m}).reverse(),this.frameMap=new Map(this.sortedFrames.map((function(e){return[e.id,e]})));var p=L(this.sortedFrames,{getNodeParents:f,getNodeKey:m});if(Object(r.a)(p.values()).some((function(e){return e.size>1})))throw new Error("Frames should only have one parent");this.frameIdParentMap=new Map(Object(r.a)(p).map((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return[n,a.size?Object(r.a)(a)[0].id:null]}))),this.frameIdPathMap=G(this.sortedFrames,{getNodeParents:function(e){return Object(r.a)(p.get(e.id))},getNodeKey:m,visitNode:function(e,t){return t.length?[].concat(Object(r.a)(t[0]),[e.id]):[e.id]}})}return Object(c.a)(e,[{key:"getDomElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("stateMap"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.eye(3),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.key,r=void 0===a?void 0:a;return T.a.createElement("g",{className:"scene",key:r},this.decals.map((function(e,n){return e.getDomElement(t,{key:"decal"+n})})),this.frames.map((function(n,a){return n.getDomElement(e,t,{key:"frame"+a})})))}},{key:"getInitialStateMap",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.randomize,a=void 0!==n&&n;if(a){var i=function(){return(Math.random()-.5)*Math.PI*2};e=function(e){return[i(),i()]}}else e=function(e){return e.initialState};return new Map(this.sortedFrames.map((function(t){return[t.id,e(t)]})))}}]),e}(),$=n(17),H=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("scene");Object(s.a)(this,e),this.scene=t}return Object(c.a)(e,[{key:"_makeStateMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("qs"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("qds");return new Map(this.scene.sortedFrames.map((function(n,a){return[n.id,[e[a],t[a]]]})))}},{key:"_getPosMatMap",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("stateMap"),n=new Map,a=Object($.a)(this.scene.sortedFrames);try{for(a.s();!(e=a.n()).done;){var i=e.value,r=t.get(i.id),s=Object(o.a)(r,1),c=s[0],d=this.scene.frameIdParentMap.get(i.id),l=i.getPosMatrix(c);d&&(l=n.get(d).matMul(l)),n.set(i.id,l)}}catch(u){a.e(u)}finally{a.f()}return n}},{key:"_getInvPosMatMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("posMatMap");return new Map(Object(r.a)(e).map((function(e){var t=Object(o.a)(e,2);return[t[0],_(t[1])]})))}},{key:"_getVelMatMap",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("posMatMap"),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("invPosMatMap"),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M("stateMap");return new Map(this.scene.sortedFrames.map((function(i){var r=a.get(i.id),s=Object(o.a)(r,1)[0],c=e.scene.frameIdParentMap.get(i.id),d=i.getVelMatrix(s).matMul(n.get(i.id));return c&&(d=t.get(c).matMul(d)),[i.id,d]})))}},{key:"_getAccelMatMap",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("posMatMap"),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("invPosMatMap"),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M("stateMap");return new Map(this.scene.sortedFrames.map((function(i){var r=a.get(i.id),s=Object(o.a)(r,1)[0],c=e.scene.frameIdParentMap.get(i.id),d=i.getAccelMatrix(s).matMul(n.get(i.id));return c&&(d=t.get(c).matMul(d)),[i.id,d]})))}},{key:"_getVelSumMatMap",value:function(){arguments.length>0&&void 0!==arguments[0]||M("posMatMap");var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("velMatMap"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M("stateMap"),a=new Map,i=Object($.a)(this.scene.sortedFrames);try{for(i.s();!(e=i.n()).done;){var r=e.value,s=n.get(r.id),c=Object(o.a)(s,2),d=c[1],l=this.scene.frameIdParentMap.get(r.id),u=t.get(r.id).mul(d);l&&(u=u.add(a.get(l))),a.set(r.id,u)}}catch(h){i.e(h)}finally{i.f()}return a}},{key:"_getAccelSumMatMap",value:function(){arguments.length>0&&void 0!==arguments[0]||M("posMatMap");var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("velMatMap"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M("accelMatMap"),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M("velSumMatMap"),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:M("stateMap"),r=new Map,s=Object($.a)(this.scene.sortedFrames);try{for(s.s();!(e=s.n()).done;){var c=e.value,d=i.get(c.id),l=Object(o.a)(d,2),u=l[1],h=this.scene.frameIdParentMap.get(c.id),v=n.get(c.id).mul(u*u);if(h){var g=r.get(h),f=a.get(h),m=t.get(c.id);v=v.add(g).add(f.matMul(m).mul(2*u))}r.set(c.id,v)}}catch(p){s.e(p)}finally{s.f()}return r}},{key:"_getWeightPosMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("posMatMap");return new Map(this.scene.sortedFrames.map((function(t){return[t.id,t.weights.map((function(n){return e.get(t.id).matMul(n.position)}))]})))}},{key:"_isFrameDescendent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("descendentFrame"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("ancestorFrame");return-1!==this.scene.frameIdPathMap.get(e.id).indexOf(t.id)}},{key:"_getDescendentFrame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("frame1"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("frame2");return this._isFrameDescendent(e,t)?e:this._isFrameDescendent(t,e)?t:null}},{key:"_getDescendentFrames",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("ancestorFrame");return this.scene.sortedFrames.filter((function(n){return e._isFrameDescendent(n,t)}))}},{key:"_getCoefficientMatrixEntry",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("rowIndex"),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("colIndex"),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M("velMatMap"),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M("weightPosMap"),o=this.scene.sortedFrames[t],s=this.scene.sortedFrames[n],c=a.get(o.id),d=a.get(s.id),l=this._getDescendentFrame(o,s),u=l?this._getDescendentFrames(l):[],h=0,v=Object($.a)(u);try{for(v.s();!(e=v.n()).done;)for(var g=e.value,f=0;f<g.weights.length;f++){var m=g.weights[f],p=r.get(g.id)[f];h+=m.mass*i.matMul(d.matMul(p),c.matMul(p),!0).dataSync()[0]}}catch(y){v.e(y)}finally{v.f()}return h}},{key:"_getCoefficientMatrix",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("velMatMap"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("weightPosMap"),n=this.scene.sortedFrames.length,a=Array(n),r=0;r<n;r++){for(var o=Array(n),s=0;s<n;s++)o[s]=this._getCoefficientMatrixEntry(r,s,e,t);a[r]=o}return i.tensor2d(a)}},{key:"_getForceVectorEntry",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("baseFrame"),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("velMatMap"),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M("velSumMatMap"),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M("accelSumMatMap"),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:M("weightPosMap"),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:M("stateMap"),c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:M("externalForceMap"),d=0,l=n.get(t.id),u=Object($.a)(this._getDescendentFrames(t));try{for(u.s();!(e=u.n()).done;){for(var h=e.value,v=a.get(h.id),g=i.get(h.id),f=0;f<h.weights.length;f++){var m=h.weights[f],p=r.get(h.id)[f],y=l.matMul(p),w=v.matMul(p),b=g.matMul(p),O=-m.mass*y.matMul(b,!0).dataSync()[0],j=-m.mass*this.scene.gravity*y.dataSync()[1],k=-m.drag*y.matMul(w,!0).dataSync()[0];d=O+k+j}var x=s.get(t.id),E=Object(o.a)(x,2),S=E[1],_=-t.resistance*S,P=c&&c.get(t.id)||0;d+=P+_}}catch(F){u.e(F)}finally{u.f()}return d}},{key:"_getForceVector",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("velMatMap"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("velSumMatMap"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M("accelSumMatMap"),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M("weightPosMap"),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:M("stateMap"),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:M("externalForceMap"),s=this.scene.sortedFrames.length,c=Array(s),d=0;d<s;d++)c[d]=this._getForceVectorEntry(this.scene.sortedFrames[d],e,t,n,a,r,o);return i.tensor1d(c).reshape([s,1])}},{key:"_getSystemOfEquations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("stateMap"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("externalForceMap"),n=this._getPosMatMap(e),a=this._getInvPosMatMap(n),i=this._getVelMatMap(n,a,e),r=this._getAccelMatMap(n,a,e),o=this._getVelSumMatMap(n,i,e),s=this._getAccelSumMatMap(n,i,r,o,e),c=this._getWeightPosMap(n),d=this._getCoefficientMatrix(i,c),l=this._getForceVector(i,o,s,c,e,t);return[d,l]}},{key:"_solve",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("stateMap"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("externalForceMap"),n=this._getSystemOfEquations(e,t),a=Object(o.a)(n,2),i=a[0],r=a[1];return P(i,r,{asTensor:!1})}},{key:"_applyDeltas",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("stateMap"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("qddArray"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M("deltaTime"),a=new Map,i=0;i<this.scene.sortedFrames.length;i++){var r=this.scene.sortedFrames[i],s=t[i],c=e.get(r.id),d=Object(o.a)(c,2),l=d[0],u=d[1],h=l+u*n,v=u+s*n;a.set(r.id,[h,v])}return a}},{key:"_tickSimple",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("stateMap"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("deltaTime"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M("externalForceMap"),a=this._solve(e,n);return this._applyDeltas(e,a,t)}},{key:"_tickRungeKutta",value:function(){arguments.length>0&&void 0!==arguments[0]||M("stateMap"),arguments.length>1&&void 0!==arguments[1]||M("deltaTime"),arguments.length>2&&void 0!==arguments[2]||M("externalForceMap");throw new f("Runge-Kutta tick functionality not implemented yet")}},{key:"tick",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("stateMap"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M("deltaTime"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=a.rungeKutta,r=void 0!==i&&i,o=r?this._tickRungeKutta:this._tickSimple;return o.bind(this)(e,t,n)}}]),e}(),Q=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=a.position,r=void 0===i?h:i,o=a.angle,c=void 0===o?0:o,d=a.decals,l=void 0===d?[]:d,u=a.weights,g=void 0===u?[]:u,f=a.frames,m=void 0===f?[]:f,p=a.resistance,M=void 0===p?0:p,y=a.initialState,w=void 0===y?v:y,b=a.id,O=void 0===b?void 0:b;return Object(s.a)(this,n),(e=t.call(this,{angle:c,decals:l,weights:g,frames:m,resistance:M,initialState:w,position:r,id:O})).angle=c,e}return Object(c.a)(n,[{key:"xform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("xformMatrix"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.decals,i=void 0===a?void 0:a,r=t.weights,o=void 0===r?void 0:r,s=t.frames,c=void 0===s?void 0:s;return new n({position:e.matMul(this.position),angle:this.angle+S(e),decals:null!=i?i:this.decals,weights:null!=o?o:this.weights,frames:null!=c?c:this.frames,resistance:this.resistance,initialState:this.initialState})}},{key:"getPosMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M("q"),t=this.position.dataSync();return O([t[0]+e*Math.cos(this.angle),t[1]+e*Math.sin(this.angle)])}},{key:"getVelMatrix",value:function(){arguments.length>0&&void 0!==arguments[0]||M("q");return i.tensor2d([[0,0,Math.cos(this.angle)],[0,0,Math.sin(this.angle)],[0,0,0]])}}]),n}(K),X=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.position,i=void 0===a?h:a,r=n.drag,o=void 0===r?0:r;Object(s.a)(this,e),this.mass=t,this.position=y(i),this.drag=o}return Object(c.a)(e,[{key:"xform",value:function(t){return new e({mass:this.mass,position:t.matMul(this.position),drag:this.drag})}}]),e}(),Y=new R({id:"pendulum2",initialState:[0,0],decals:[new V({endPos:[5,0],lineWidth:.2}),new W({position:[5,0],radius:1})],position:[5,0],weights:[new X(10,{position:[5,0]})],resistance:4}),Z=new R({id:"pendulum1",initialState:[-.3*Math.PI,0],decals:[new V({endPos:[5,0],lineWidth:.2}),new W({position:[5,0],radius:1})],frames:[Y],weights:[new X(5,{position:[5,0]})],resistance:4}),ee=new Q({id:"cart",decals:[new I({width:3,height:3/1.618,lineWidth:.2})],frames:[Z],weights:[new X(100)],resistance:10}),te=new U({frames:[ee],decals:[new V({startPos:[-300,0],endPos:[300,0],color:"gray",lineWidth:.1})]}),ne=new H(te);var ae=function(){var e=Object(D.useState)([300,300]),t=Object(o.a)(e,2),n=Object(o.a)(t[0],2),i=n[0],s=n[1],c=t[1],d=Object(D.useState)(15),l=Object(o.a)(d,2),u=l[0],h=l[1],v=function(e){var t=Object(D.useState)(new Set),n=Object(o.a)(t,2),i=n[0],r=n[1],s=Object(D.useRef)();return s.current=e,Object(D.useEffect)((function(){function e(e){var t=e.code,n=e.keyCode;r((function(e){return e.has(t)||(e=Object(a.a)(e,(function(e){e.add(t)})),s.current&&s.current({keyName:t,keyId:n,pressed:!0})),e}))}function t(e){var t=e.code,n=e.keyCode;r((function(e){return e.has(t)&&(e=Object(a.a)(e,(function(e){e.delete(t)})),s.current&&s.current({keyName:t,keyId:n,pressed:!1})),e}))}return window.addEventListener("keydown",e),window.addEventListener("keyup",t),function(){window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}}),[]),i}(),g=O([i,s]).matMul(b(u,-u)),f=Object(D.useState)(te.getInitialStateMap()),m=Object(o.a)(f,2),p=m[0],M=m[1];return function(e,t){var n=t&&t.fps||60,a=T.a.useRef({prevTime:0}),i=T.a.useRef(),r=T.a.useRef();a.current.callback=e,T.a.useEffect((function(){return i.current=requestAnimationFrame((function e(t){var o=(t-a.current.prevTime)/1e3;a.current.callback(o),a.current.prevTime=t,r.current=setTimeout((function(){i.current=requestAnimationFrame(e)}),1e3/n-o)})),function(){cancelAnimationFrame(i.current),r.current&&clearTimeout(r.current)}}),[n])}((function(e){var t=0;Object.entries({KeyA:function(){t-=2e3},KeyD:function(){t+=2e3},Minus:function(){return h(u*Math.exp(-e))},Equal:function(){return h(u*Math.exp(e))},ArrowLeft:function(){return c((function(t){var n=Object(o.a)(t,2),a=n[0],i=n[1];return[a+150*e,i]}))},ArrowRight:function(){return c((function(t){var n=Object(o.a)(t,2),a=n[0],i=n[1];return[a-150*e,i]}))},ArrowUp:function(){return c((function(t){var n=Object(o.a)(t,2);return[n[0],n[1]+150*e]}))},ArrowDown:function(){return c((function(t){var n=Object(o.a)(t,2);return[n[0],n[1]-150*e]}))}}).forEach((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return v.has(n)&&a()}));for(var n=new Map([[ee.id,t]]),a=p,i=0;i<10;i++)a=ne.tick(a,e/10,n);(function(e){return Object(r.a)(e).every((function(e){var t=Object(o.a)(e,2),n=(t[0],Object(o.a)(t[1],2)),a=n[0],i=n[1];return!isNaN(a)&&!isNaN(i)}))})(a)||(console.warn("Encountered invalid state map; resetting to initial state..."),a=te.getInitialStateMap()),M(a)})),T.a.createElement("div",{className:"app__main"},T.a.createElement("div",{className:"plot"},T.a.createElement("h2",{className:"plot__title"},"Poi-bot"),T.a.createElement("div",{className:"plot__main"},T.a.createElement("svg",{className:"plot__svg"},te.getDomElement(p,g)))))},ie=n(247),re=n.n(ie);i.setBackend("cpu"),a.b(),window.tf=i,re.a.render(T.a.createElement(T.a.StrictMode,null,T.a.createElement(ae,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[248,1,2]]]);
//# sourceMappingURL=main.b06b0e2c.chunk.js.map